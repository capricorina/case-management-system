{% extends "base.html" %}

{% block title %}{{ title }} - RJ Case Management{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-10 mx-auto">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>
                <i class="bi bi-person me-2"></i>{{ title }}
            </h2>
            <a href="{% if participant %}{{ url_for('participant_detail', id=participant.id) }}{% else %}{{ url_for('participants') }}{% endif %}" 
               class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-1"></i>Back
            </a>
        </div>

        <form method="POST">
            {{ form.hidden_tag() }}
            
            <!-- Basic Information -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-person-lines-fill me-2"></i>Basic Information</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ form.first_name.label(class="form-label required") }}
                            {{ form.first_name(class="form-control" + (" is-invalid" if form.first_name.errors else "")) }}
                            {% if form.first_name.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.first_name.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ form.last_name.label(class="form-label required") }}
                            {{ form.last_name(class="form-control" + (" is-invalid" if form.last_name.errors else "")) }}
                            {% if form.last_name.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.last_name.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ form.date_of_birth.label(class="form-label") }}
                            {{ form.date_of_birth(class="form-control" + (" is-invalid" if form.date_of_birth.errors else "")) }}
                            {% if form.date_of_birth.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.date_of_birth.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact Information -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-telephone me-2"></i>Contact Information</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ form.phone.label(class="form-label") }}
                            {{ form.phone(class="form-control" + (" is-invalid" if form.phone.errors else "")) }}
                            {% if form.phone.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.phone.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ form.email.label(class="form-label") }}
                            {{ form.email(class="form-control" + (" is-invalid" if form.email.errors else "")) }}
                            {% if form.email.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.email.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        {{ form.street_address.label(class="form-label") }}
                        {{ form.street_address(class="form-control" + (" is-invalid" if form.street_address.errors else "")) }}
                        {% if form.street_address.errors %}
                            <div class="invalid-feedback">
                                {% for error in form.street_address.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            {{ form.city.label(class="form-label") }}
                            {{ form.city(class="form-control" + (" is-invalid" if form.city.errors else "")) }}
                            {% if form.city.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.city.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ form.state.label(class="form-label") }}
                            {{ form.state(class="form-select" + (" is-invalid" if form.state.errors else "")) }}
                            {% if form.state.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.state.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ form.zip_code.label(class="form-label") }}
                            {{ form.zip_code(class="form-control" + (" is-invalid" if form.zip_code.errors else "")) }}
                            {% if form.zip_code.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.zip_code.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Communication Preferences -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-chat-dots me-2"></i>Communication Preferences</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ form.preferred_contact_method.label(class="form-label") }}
                            {{ form.preferred_contact_method(class="form-select" + (" is-invalid" if form.preferred_contact_method.errors else "")) }}
                            {% if form.preferred_contact_method.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.preferred_contact_method.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ form.preferred_language.label(class="form-label") }}
                            {{ form.preferred_language(class="form-select" + (" is-invalid" if form.preferred_language.errors else "")) }}
                            {% if form.preferred_language.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.preferred_language.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Emergency Contact -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-person-exclamation me-2"></i>Emergency Contact</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ form.emergency_contact_name.label(class="form-label") }}
                            {{ form.emergency_contact_name(class="form-control" + (" is-invalid" if form.emergency_contact_name.errors else "")) }}
                            {% if form.emergency_contact_name.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.emergency_contact_name.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ form.emergency_contact_phone.label(class="form-label") }}
                            {{ form.emergency_contact_phone(class="form-control" + (" is-invalid" if form.emergency_contact_phone.errors else "")) }}
                            {% if form.emergency_contact_phone.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.emergency_contact_phone.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ form.emergency_contact_relationship.label(class="form-label") }}
                            {{ form.emergency_contact_relationship(class="form-select" + (" is-invalid" if form.emergency_contact_relationship.errors else "")) }}
                            {% if form.emergency_contact_relationship.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.emergency_contact_relationship.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Important Persons -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-people me-2"></i>Important Persons</h5>
                    <small class="text-muted">Additional contacts beyond emergency contact</small>
                </div>
                <div class="card-body">
                    <!-- Person 1 -->
                    <div class="border rounded p-3 mb-3">
                        <h6 class="text-muted mb-3">Contact #1</h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                {{ form.important_person_1_name.label(class="form-label") }}
                                {{ form.important_person_1_name(class="form-control") }}
                            </div>
                            <div class="col-md-6 mb-3">
                                {{ form.important_person_1_role.label(class="form-label") }}
                                {{ form.important_person_1_role(class="form-select") }}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                {{ form.important_person_1_phone.label(class="form-label") }}
                                {{ form.important_person_1_phone(class="form-control") }}
                            </div>
                            <div class="col-md-6 mb-3">
                                {{ form.important_person_1_email.label(class="form-label") }}
                                {{ form.important_person_1_email(class="form-control") }}
                            </div>
                        </div>
                    </div>

                    <!-- Person 2 -->
                    <div class="border rounded p-3 mb-3">
                        <h6 class="text-muted mb-3">Contact #2</h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                {{ form.important_person_2_name.label(class="form-label") }}
                                {{ form.important_person_2_name(class="form-control") }}
                            </div>
                            <div class="col-md-6 mb-3">
                                {{ form.important_person_2_role.label(class="form-label") }}
                                {{ form.important_person_2_role(class="form-select") }}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                {{ form.important_person_2_phone.label(class="form-label") }}
                                {{ form.important_person_2_phone(class="form-control") }}
                            </div>
                            <div class="col-md-6 mb-3">
                                {{ form.important_person_2_email.label(class="form-label") }}
                                {{ form.important_person_2_email(class="form-control") }}
                            </div>
                        </div>
                    </div>

                    <!-- Person 3 -->
                    <div class="border rounded p-3 mb-3">
                        <h6 class="text-muted mb-3">Contact #3</h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                {{ form.important_person_3_name.label(class="form-label") }}
                                {{ form.important_person_3_name(class="form-control") }}
                            </div>
                            <div class="col-md-6 mb-3">
                                {{ form.important_person_3_role.label(class="form-label") }}
                                {{ form.important_person_3_role(class="form-select") }}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                {{ form.important_person_3_phone.label(class="form-label") }}
                                {{ form.important_person_3_phone(class="form-control") }}
                            </div>
                            <div class="col-md-6 mb-3">
                                {{ form.important_person_3_email.label(class="form-label") }}
                                {{ form.important_person_3_email(class="form-control") }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- School Information -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-mortarboard me-2"></i>School Information</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8 mb-3">
                            {{ form.school_name.label(class="form-label") }}
                            {{ form.school_name(class="form-control" + (" is-invalid" if form.school_name.errors else "")) }}
                            {% if form.school_name.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.school_name.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ form.grade_level.label(class="form-label") }}
                            {{ form.grade_level(class="form-select" + (" is-invalid" if form.grade_level.errors else "")) }}
                            {% if form.grade_level.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.grade_level.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Demographic Information -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-person-badge me-2"></i>Demographic Information</h5>
                    <small class="text-muted">This information helps us better serve our participants</small>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ form.race.label(class="form-label") }}
                            {{ form.race(class="form-control" + (" is-invalid" if form.race.errors else "")) }}
                            {% if form.race.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.race.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ form.ethnicity.label(class="form-label") }}
                            {{ form.ethnicity(class="form-select" + (" is-invalid" if form.ethnicity.errors else "")) }}
                            {% if form.ethnicity.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.ethnicity.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            {{ form.gender_identity.label(class="form-label") }}
                            {{ form.gender_identity(class="form-control" + (" is-invalid" if form.gender_identity.errors else "")) }}
                            {% if form.gender_identity.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.gender_identity.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ form.sex.label(class="form-label") }}
                            {{ form.sex(class="form-select" + (" is-invalid" if form.sex.errors else "")) }}
                            {% if form.sex.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.sex.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-md-4 mb-3">
                            {{ form.pronouns.label(class="form-label") }}
                            {{ form.pronouns(class="form-control" + (" is-invalid" if form.pronouns.errors else "")) }}
                            {% if form.pronouns.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.pronouns.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ form.family_structure.label(class="form-label") }}
                            {{ form.family_structure(class="form-select" + (" is-invalid" if form.family_structure.errors else "")) }}
                            {% if form.family_structure.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.family_structure.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Health Information -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-heart-pulse me-2"></i>Health Information</h5>
                    <small class="text-muted">Important health information for participant care</small>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ form.allergies.label(class="form-label") }}
                            {{ form.allergies(class="form-control" + (" is-invalid" if form.allergies.errors else "")) }}
                            {% if form.allergies.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.allergies.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ form.illnesses_disabilities.label(class="form-label") }}
                            {{ form.illnesses_disabilities(class="form-control" + (" is-invalid" if form.illnesses_disabilities.errors else "")) }}
                            {% if form.illnesses_disabilities.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.illnesses_disabilities.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ form.primary_care_doctor.label(class="form-label") }}
                            {{ form.primary_care_doctor(class="form-control" + (" is-invalid" if form.primary_care_doctor.errors else "")) }}
                            {% if form.primary_care_doctor.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.primary_care_doctor.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            {{ form.emergency_instructions.label(class="form-label") }}
                            {{ form.emergency_instructions(class="form-control" + (" is-invalid" if form.emergency_instructions.errors else "")) }}
                            {% if form.emergency_instructions.errors %}
                                <div class="invalid-feedback">
                                    {% for error in form.emergency_instructions.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Additional Notes -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-sticky me-2"></i>Additional Notes</h5>
                </div>
                <div class="card-body">
                    {{ form.notes.label(class="form-label") }}
                    {{ form.notes(class="form-control" + (" is-invalid" if form.notes.errors else "")) }}
                    {% if form.notes.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.notes.errors %}{{ error }}{% endfor %}
                        </div>
                    {% endif %}
                </div>
            </div>

            <div class="mt-4 d-flex gap-2">
                {{ form.submit(class="btn btn-primary btn-lg") }}
                <a href="{% if participant %}{{ url_for('participant_detail', id=participant.id) }}{% else %}{{ url_for('participants') }}{% endif %}" 
                   class="btn btn-secondary btn-lg">Cancel</a>
            </div>
        </form>
    </div>
</div>

<style>
.form-label.required::after {
    content: " *";
    color: #dc3545;
}

.border.rounded {
    border-color: #dee2e6 !important;
    background-color: #f8f9fa;
}

.card-header small {
    display: block;
    margin-top: 0.25rem;
}

.text-muted {
    font-size: 0.9em;
}

/* Make the form more responsive */
@media (max-width: 768px) {
    .col-md-6, .col-md-4, .col-md-8 {
        margin-bottom: 1rem;
    }
}
</style>
{% endblock %}